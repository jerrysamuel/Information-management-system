{% extends "layouts/base.html"%}
{% load static %}
{% load humanize %}
{% block messages %}

{% if messages %}
    {% for message in messages %}
        <div class="flex items-center p-4 text-sm rounded-lg dark:bg-gray-800 {{message.tags}}" role="alert">
            <svg class="flex-shrink-0 inline w-4 h-4 mr-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
            </svg>
            <span class="sr-only">Info</span>
            <div>{{ message }}</div>
        </div>
    {% endfor %}
{% endif %}


{% endblock messages %}
{% block content %}


<div class="mt-6 p-4">
    
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
        
        <div class="mb-10">
            <a href="#" class="block max-w-sm p-6 bg-white border border-gray-200 rounded-lg shadow hover:bg-gray-100 dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-700">
                <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                    <path fill-rule="evenodd" d="M7 2a2 2 0 0 0-2 2v1a1 1 0 0 0 0 2v1a1 1 0 0 0 0 2v1a1 1 0 1 0 0 2v1a1 1 0 1 0 0 2v1a1 1 0 1 0 0 2v1a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H7Zm3 8a3 3 0 1 1 6 0 3 3 0 0 1-6 0Zm-1 7a3 3 0 0 1 3-3h2a3 3 0 0 1 3 3 1 1 0 0 1-1 1h-6a1 1 0 0 1-1-1Z" clip-rule="evenodd"/>
                  </svg>
                  
                <h5 class="mb-2 text-2xl font-bold tracking-tight text-gray-900 dark:text-white">Total Staff Employed</h5>
                <p class="font-normal text-gray-700 dark:text-gray-400">{{ human_resource_count }}</p>
                </a>
        </div>
       
            
        <div class="mb-10">
            <a href="#" class="block max-w-sm p-6 bg-white border border-gray-200 rounded-lg shadow hover:bg-gray-100 dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-700">
                <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M6 14h2m3 0h5M3 7v10a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1Z"/>
                  </svg>
                  
                <h5 class="mb-2 text-2xl font-bold tracking-tight text-gray-900 dark:text-white">Total Account details</h5>
                <p class="font-normal text-gray-700 dark:text-gray-400">{{ account_details }}</p>
                </a>
        </div>
        <div class="mb-10">
            <a href="#" class="block max-w-sm p-6 bg-white border border-gray-200 rounded-lg shadow hover:bg-gray-100 dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-700">
                <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.6 16.733c.234.269.548.456.895.534a1.4 1.4 0 0 0 1.75-.762c.172-.615-.446-1.287-1.242-1.481-.796-.194-1.41-.861-1.241-1.481a1.4 1.4 0 0 1 1.75-.762c.343.077.654.26.888.524m-1.358 4.017v.617m0-5.939v.725M4 15v4m3-6v6M6 8.5 10.5 5 14 7.5 18 4m0 0h-3.5M18 4v3m2 8a5 5 0 1 1-10 0 5 5 0 0 1 10 0Z"/>
                  </svg>
                  
                <h5 class="mb-2 text-2xl font-bold tracking-tight text-gray-900 dark:text-white">Total Monthly salaries </h5>
                <p class="font-normal text-gray-700 dark:text-gray-400">&#8358;{{ total_salaries|intcomma }}</p>
                </a>
        </div>

        <div class="mb-10">
            <a href="#" class="block max-w-sm p-6 bg-white border border-gray-200 rounded-lg shadow hover:bg-gray-100 dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-700">
    
                <h5 class="mb-2 text-2xl font-bold tracking-tight text-gray-900 dark:text-white">Net Worth of Resources</h5>
                <p class="font-normal text-gray-700 dark:text-gray-400">&#8358;{{ net_worth_resources|intcomma }}</p>
                </a>
        </div>
        <div class="mb-10">
            <a href="#" class="block max-w-sm p-6 bg-white border border-gray-200 rounded-lg shadow hover:bg-gray-100 dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-700">
    
                <h5 class="mb-2 text-2xl font-bold tracking-tight text-gray-900 dark:text-white">Total Food Sales</h5>
                <p class="font-normal text-gray-700 dark:text-gray-400">&#8358;{{ total_unit_sold_worth|intcomma }}</p>
                </a>
        </div>
        <div class="mb-10">
            <a href="#" class="block max-w-sm p-6 bg-white border border-gray-200 rounded-lg shadow hover:bg-gray-100 dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-700">
    
                <h5 class="mb-2 text-2xl font-bold tracking-tight text-gray-900 dark:text-white">Total Available Dishes</h5>
                <p class="font-normal text-gray-700 dark:text-gray-400">{{ total_menu|intcomma }}</p>
                </a>
        </div>
    
        
        
        
        
                                                
    </div>
</div>

<div class="mb-12">
<!-- Other content of dashboard.html -->
<div id="warning-message" class="hidden p-4 bg-yellow-200 rounded-lg mb-12">
    <!-- Warning message content will be added dynamically -->
</div>
<div id="pie-chart">
    <h1 class="text-xl text-center dark:text-white">Resource category Percentages</h1>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Retrieve the categories and worth percentages from the template context
    const categories = JSON.parse("{{ categories|escapejs }}");
    const worthPercentages = JSON.parse("{{ worth_percentages|escapejs }}");

    // Function to calculate the data labels for the pie chart
    const getDataLabels = () => {
      return worthPercentages.map((percentage) => percentage + "%");
    };

    // Options for the pie chart
    const options = {
      series: worthPercentages,
      labels: categories,
      colors: ["#1C64F2", "#16BDCA", "#9061F9", "#FDBA8C", "#FF5C5C", "#2DCE89", "#FFA500", "#FF5733", "#006400", "#800080"], // Add more colors if needed
      chart: {
        height: 420,
        width: "100%",
        type: "pie",
      },
      stroke: {
        colors: ["white"],
        lineCap: "",
      },
      plotOptions: {
        pie: {
          size: "100%",
          dataLabels: {
            offset: -25,
            formatter: function (value, { seriesIndex, dataPointIndex, w }) {
              return getDataLabels()[dataPointIndex];
            }
          }
        },
      },
      legend: {
        position: "bottom",
        fontFamily: "Inter, sans-serif",
      },
      dataLabels: {
        enabled: true,
        style: {
          fontFamily: "Inter, sans-serif",
        },
      },
    };

    // Render the pie chart using ApexCharts
    const chart = new ApexCharts(document.getElementById("pie-chart"), options);
    chart.render();
  });
</script>
<div class="mb-10 grid grid-cols-2 gap-2">
    <div id="gender-chart" class="w-full mt-4">
        <h1 class="text-xl dark:text-white text-center">(Gender) Staff Charts</h1>
    </div>
    
    <script>
        // Get the gender data from the context passed by Django
        const genders = {{ genders|safe }};
        const percentages = {{ percentages|safe }};
    
        // Prepare the chart options
        const chartOptions = {
            series: percentages,
            labels: genders,
            chart: {
                type: 'donut',
                height: 320,
            },
            plotOptions: {
                pie: {
                    donut: {
                        size: '70%',
                    }
                }
            },
            legend: {
                position: 'bottom',
            },
        };
    
        // Render the chart
        if (document.getElementById("gender-chart") && typeof ApexCharts !== 'undefined') {
            const chart = new ApexCharts(document.getElementById("gender-chart"), chartOptions);
            chart.render();
        }
    </script>
    <div id="staff-chart" class="w-full mt-4">
        <h1 class="text-xl dark:text-white text-center"> Staff Category Charts</h1>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Retrieve the categories and counts from the Django template context
            const labels = JSON.parse("{{ labels|escapejs }}");
            const counts = JSON.parse("{{ counts|escapejs }}");
            // Prepare the chart options
            const options = {
                series: counts,
                labels: labels,
                chart: {
                    type: 'pie',
                    height: 320,
                },
                plotOptions: {
                    pie: {
                        size: '70%',
                    }
                },
                legend: {
                    position: 'bottom',
                },
            };
    
            // Render the chart using ApexCharts
            if (document.getElementById("staff-chart") && typeof ApexCharts !== 'undefined') {
                const chart = new ApexCharts(document.getElementById("staff-chart"), options);
                chart.render();
            }
        });
    </script>
    
</div>

<div id="daily-sales-chart">
    <h1 class='text-2xl dark:text-white text-center text-bold'> Daily Sales Chart</h1>
</div>
    
<script>
    const dates = {{ dates|safe }};
    const unitsSold = {{ units_sold|safe }};

    const options = {
        chart: {
            type: 'line',
            height: 350
        },
        series: [{
            name: 'Units Sold',
            data: unitsSold
        }],
        xaxis: {
            categories: dates
        }
    };

    const chart = new ApexCharts(document.querySelector("#daily-sales-chart"), options);
    chart.render();
</script>

<script>
    $(document).ready(function() {
        // Function to fetch low-resource data
        function checkResources() {
            $.ajax({
                url: "{% url 'check_resources' %}",
                type: "GET",
                dataType: "json",
                success: function(data) {
                    if (data.length > 0) {
                        // Clear previous warnings
                        $('#warning-message').empty();
                        // Add text before the list
                        $('#warning-message').append('<p class="font-bold mb-2">You\'re running low on the following resources:</p>');
                        // Create a container for the list
                        var resourceList = $('<ul>').addClass('list-none flex');
                        // Iterate over the data and create list items for each resource
                        data.forEach(function(resource, index) {
                            // Add a comma before the resource name if it's not the first one
                            var resourceName = (index > 0 ? ', ' : '') + resource.name;
                            var listItem = $('<li>').addClass('inline-block mr-2 font-bold').text(resourceName);
                            resourceList.append(listItem);
                        });
                        // Append the list to the warning message
                        $('#warning-message').append(resourceList);
                        // Show the warning message
                        $('#warning-message').show();
                    } else {
                        // Hide the warning message if there are no low resources
                        $('#warning-message').hide();
                    }
                },
                error: function(xhr, status, error) {
                    console.error("Error fetching low-resource data:", error);
                }
            });
        }
    
        // Fetch low-resource data initially
        checkResources();
    
        // Fetch low-resource data every 5 seconds
        setInterval(checkResources, 5000); // Adjust interval as needed
    });
    
</script>

</div>
<br>
<br>
<br>
<br>
<div class=" text-center mb-12">
    <h1 class="text-4xl text-gray-600 lg:text-5xl ">
        Admin Dashboard
    </h1>
    <h6 class="text-gray-600">
        Manage your Restaurant efficiently........
    </h6>
</div>

{% endblock %}


